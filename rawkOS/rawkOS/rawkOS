#!/usr/bin/env -S just --justfile
[private]
default:
	@just --choose --justfile {{ source_file() }}

nix-install:
	#!/usr/bin/env bash
	if command -v nix &> /dev/null; then
		echo "Nix already installed"
		exit 1
	fi

	curl --proto '=https' --tlsv1.2 -sSf -L https://install.determinate.systems/nix | \
			sh -s -- install ostree --no-confirm --persistence=/var/lib/nix
	echo "Defaults  secure_path = /nix/var/nix/profiles/default/bin:/nix/var/nix/profiles/default/sbin:\$(sudo printenv PATH)" | sudo tee /etc/sudoers.d/nix-sudo-env
	sudo echo "trusted-users = ${USER}" | sudo tee -a /etc/nix/nix.conf
	sudo systemctl stop nix-daemon.service
	sudo systemctl restart nix-daemon.socket

devenv-install:
	nix profile install \
		--experimental-features "nix-command flakes" \
		--accept-flake-config \
		nixpkgs#devenv

flox-install:
	nix profile install \
		--experimental-features "nix-command flakes" \
		--accept-flake-config \
		'github:flox/flox'
